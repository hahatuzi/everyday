[!学习视频]https://www.bilibili.com/video/BV1cR4y1F7ba/?p=3&spm_id_from=pageDriver&vd_source=afbd897dda8c1c6166fce57f249edafd
[!V8的垃圾回收]https://zhuanlan.zhihu.com/p/612755292
# 一：v8引擎执行原理
js源代码 --> parse --> AST抽象语法树 --> lgnition --> bytecode字节码 --> 运行结果
- lgnition:是v8的解释器，它将AST转换为字节码
# 二：垃圾回收

  ### 1.内存泄露
  - (1)全局变量滥用
  - (2)定时器未被清理
  - (3)闭包
  - (4)DOM引用，被引用的元素是无法被释放的
  - (5)监听器没有移除
  ### 2.避免内存泄漏
  - 减少使用全局变量
    ```js
      var a = 1
      function fn() {
        return function () {
          return function () {
            // 为了避免使用全局变量a,我们可以再定义一个函数作用域的变量b
            let b = a
            for(let i = 0; i < 10000; i++){
              // console.log(a)
              console.log(b)
            }
          }
        }
      }
      fn()()()
    ```
  - V8会为每个对象分配一个隐藏类

# 三：v8引擎内存管理
  ### 1.垃圾回收算法
  - GC（garbage collection）垃圾回收,常见的GC算法：
  - (1)记数法
  - (2)标记清除(清除未被引用的对象)
  - (3)标记整理，在标记清除的基础上将保留的对象搬运汇集到连续的内存空间，达到空间整合的目的
  - (4)分代收集：对象被分成两组：新的和旧的，老旧的数据被检查的频次也会减少，常用的新的数据很快就会被清理。
  - (5)增量收集，尝试一次遍历并标记所有对象。
  - (6)闲时收集：垃圾手机只会在CPU空闲的时间尝试运行，减少对代码执行的影响
  ### 2.v8内存划分
    - New Space:存放生命周期较短的对象
    - Old Space
    - large Object space：大对象
    - code space
    - cell space：存放小的数据结构比如闭包的变量环境
    - property space
    - map space
    - 堆内存Heap Memory和占Stack
  ```js
    // 这也就是闭包的产生来源。
    <!-- 如下题：
    // 请问有几个变量没有被回收 -->
    var i = 1;
    var i = 2;// 全局变量i不会被回收
    var add = function() {  // 全局变量add不会被回收
      var i = 0;
      return function()
      {
        i++; // 引用的局部变量i不会被回收
        console.log(i);
      }
    }();
    add();
  ```