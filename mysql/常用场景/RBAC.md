# RBAC，基于角色的访问控制，角色就是权限的集合
### 1.设计难点
#### 设计的难点在如何评定角色，即角色的划分。简单的就是基于不同用户的权限集合，但是当用户过多时给每个用户都分配权限太过繁琐，所以可以参考部门，岗位等实际情况
比如我们可以分为用户管理和角色管理，给用户分配不同的角色
### 2.设计模型
企业开发中RBAC模型设计为7张表，其中4张为基础表，3张为中间表，简单的RBAC设计为5张表
### 3.表结构分析
用户(管理员) <---n-n---> 角色权限 <---n-n---> 权限(资源) <---n-n---> 菜单
            用户角色中间表       角色权限中间表      权限菜单中间表
**权限（资源）表解释：资源并不是菜单，而是将功能，菜单等划分为类后的结果，比如可以划分为（商品（添加，删除，审核，修改等），订单，用户，设置）**
然后再和 菜单对应，比如商品列表内可能有多个权限资源（商品添加，商品删除等），权限资源表存在的目的就是为了实现对菜单中功能点的控制
**res_key：自动定义好的权限标识**
**parent_id：权限表的层次结构为2层**
用户(管理员)   | 角色权限             | 用户角色中间表  | 权限(资源)                 |  菜单 |  角色权限中间表|  权限菜单中间表
------------  | -------------------- | --------------| --------------------------| --------｜
id(int)()key  | id角色id(int)key     | admin_id(主键) | id(int)(资源id)key        |     id   |
name(varchar) | name角色名称(varchar）| role_id(主键) | res_key(资源key)varchar    |     name   |
password      |                      |               | res_name(资源名称)varchar  |     url  |
status        |                      |               | parent_id(上级资源id)int   |     parent_id |
举例：
权限(资源)表 
id     |   res_key     | res_name     | parent_id  |
----   | ------------- | -------------| -----------|
1      | goods         |   商品       |       0    |
2      | orders        |   订单       |      0     |
3      | config        |   设置       |      0     |
4      | goods_add     |   商品添加   |      1      |
5      | goods_edit    |   商品修改   |      1      |
6      | goods_delete  |   商品删除   |      1      |
7      | goods_audit   |   商品审核   |      1      |
8      | goods_config  |   商品配置   |      1      |

菜单表 
id     |   name        | url                | parent_id  |
----   | ------------- | -------------------| -----------|
1      | 首页          |   null             |       0    |
2      | 商品          |   null             |       0    |
2-1    | 商品列表      |   goods/list       |        2    |
2-1-1  | 商品审核      |   goods/audit        |      2-1    |
2-1-2  | 商品配置      |   goods/delete      |      2-1    |


权限(资源)菜单联表 
resource_id  |   menu_id     |
----------   | ------------- |
4            | 2-1           |
5            | 2-1           |
6            | 2-1           |
6            | 2-2           |
6            | 2-3           |

**权限与菜单联表通常由开发人员维护，并不会暴露给用户**
比如这样的维护形式,(这里的接口就代表权限资源)
菜单         |   接口          |
----------   | -------------- |
goods/list   | /goods/list    |
             | /goods/delete  |
             | /goods/add     |
goods/audit  | /goods/list    |
             | /goods/audit   |

### 4.业务场景
（1）用户登录获取菜单
服务端操作涉及操作：用户-->表查角色-->再联表查权限资源-->联表查菜单表
**参考vue目录下的路由权限**
前端：获取到菜单对象 --> 树性结构化 --> 转成vue路由结构 -->  添加到静态路由中